<!doctype html><html lang=en><head><meta name=generator content="Hexo 3.9.0"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta http-equiv=Accept-CH content="DPR, Viewport-Width, Width"><title>Ways to authenticate Azure Databricks REST API - Amine Kaabachi</title><link rel=dns-prefetch href=//res.cloudinary.com><link rel=dns-prefetch href=//www.google-analytics.com><meta name=description content="This article will give you insight on which authentification method to choose for your use-case and also give you a fast track to implementing it (backed by links to Microsoft docs for further details)."><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><link rel=alternate type=application/rss+xml title="Amine Kaabachi" href=https://kaabachi.io/feed.xml><meta name=twitter:card content=summary_large_image><meta name=twitter:url content="https://kaabachi.io/ways-to-authenticate-azure-databricks-api/" property=og:url><meta name=twitter:title content="Ways to authenticate Azure Databricks REST API" property=og:title><meta name=twitter:description content="This article will give you insight on which authentification method to choose for your use-case and also give you a fast track to implementing it (backed by links to Microsoft docs for further details)." property=og:description><meta property=og:image content=https://kaabachi.io/assets/images/posts/auth-databricks/feature.png><meta name=twitter:image content=https://kaabachi.io/assets/images/posts/auth-databricks/feature.png><link rel=canonical href="https://kaabachi.io/ways-to-authenticate-azure-databricks-api/"><style>*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;border:none;font:inherit;margin:0;padding:0;vertical-align:baseline}button,input{background:0 0}html{font-size:18px}@media (max-width:768px){html{font-size:16px}}body{background:#fff;color:#555;font-family:Georgia,Times;font-weight:300;font-style:normal;line-height:1.5rem;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%}h1,h2,h3,h4,h5{color:#212121;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:600;line-height:2rem;margin-bottom:1.5rem}#menu a,.button{font-size:1em;font-weight:400}.post ol,.post ul,amp-video,amp-vimeo,amp-youtube,iframe,p,video{margin:0;margin-bottom:1rem}twitterwidget{margin-bottom:1em!important}a{color:#07689f;font-weight:inherit;text-decoration:none;transition:color .15s ease-out,border-bottom-color .15s ease-out}a:hover{color:#07689f}abbr{border-bottom:1px dashed #ccc;text-decoration:none}p a{border-bottom:1px solid #eee}p a:hover{border-bottom-color:#212121}strong{font-weight:700}em{font-style:italic}h1{font-size:1.7rem}h2{color:#444;display:inline-block;font-size:1.6rem;font-weight:400;margin-top:1rem}h3{color:#666;display:inline-block;font-size:1.4rem;font-weight:400;margin-top:1rem}h4{font-size:1.18rem}h5{font-size:1rem}a h1,a h2,a h3,a h4,a h5{transition:color .15s ease-out}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#3498db}.quote{margin:0 0 15px 0}blockquote{border-left:2px solid #ccc;font-style:italic;margin:0 0 15px 0;padding-left:20px}ol,ul{margin:0 0 15px 0;padding-left:25px}ul{list-style:square}ol{list-style:decimal}hr{background:#eee;color:#eee;clear:both;display:block;height:2px;margin:30px auto;width:50%}code,pre{color:#333;font-family:Courier,Menlo,Monaco;font-size:.8em;letter-spacing:0;overflow-x:auto}pre{padding:.8em 1em;white-space:pre-wrap}code{margin:0}.post::after{display:block;clear:both;content:""}.main-header{background-color:#ff8e6e;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;overflow:hidden;margin-bottom:1.5rem;padding:1rem;position:relative;text-align:center;width:100%}#menu{display:inline-block;line-height:2rem}#menu a{color:#fff;font-size:.9rem;margin-left:1rem;padding:1rem .5rem;text-transform:uppercase}@media (max-width:500px){#menu a{margin-left:.5rem;padding:.5rem .25rem}}#menu a:first-child{margin-left:0}#menu a[aria-current]{font-weight:700}#page{margin:0 auto;max-width:41rem;padding-left:1.5rem;padding-right:1.5rem;position:relative}.videoWrapper{height:0;margin-bottom:1em;padding-bottom:56.25%;padding-top:25px;position:relative}.videoWrapper amp-youtube,.videoWrapper iframe{height:100%;left:0;position:absolute;top:0;width:100%}.wrapper{border-top:2px solid #eee;padding-top:2rem}.wrapper:first-child{border-top:none;padding-top:1rem}.posts-list h2{margin-top:0}.post{display:block;margin-bottom:2rem;width:100%}.post div[itemprop=articleBody]>p:first-child{color:#333}.post li{margin-bottom:.5rem}.post p+img{margin-bottom:1rem}.post p img{border:1px solid #eee;display:block;max-width:100%}.post img+.caption,.post img+figcaption{padding-top:.5rem}.post .svg-container{margin-bottom:5%;max-width:100%;text-align:center}figure{padding-bottom:1em}video{height:auto;max-width:100%}.post .svg-container object{width:100%}.tag-list{display:inline-block;list-style-type:none;margin:0;padding:0;padding-bottom:1rem}.tag-list-item{display:inline-block;margin-left:.8em}.pagination{padding-bottom:1rem;text-align:center}.pagination a{min-width:30px;max-height:30px;text-align:center}footer{border-top:1px dashed #ddd;padding:2em;text-align:center}.timing-stats{font-size:.7em;padding:.35em}.button{background-color:#fff;border:1px solid #555;border-radius:2rem;color:#555;display:inline-block;padding:.5rem 1rem;transition:background-color .15s ease-out}.button:hover{background-color:#3498db;border-color:transparent;color:#fff}.button.inactive{background-color:#ccc;color:#fff}.search-goog input{border:2px solid #ddd;padding:10px}.search-goog input[type=submit]{background-color:#ddd;cursor:pointer}@media (max-width:768px){#page,.wrapper{margin:0;max-width:100%;width:100%}.wrapper{padding-top:2rem}.wraper::after{clear:both;content:"";display:block}}.outscreen{height:1px;left:-1000px;overflow:hidden;position:absolute;top:auto;width:1px}.callout{border:1px solid #eee;border-left-color:#777;border-left-width:5px;border-radius:3px;font-size:.9rem;padding:20px;margin:20px 0}.author{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.8rem;margin-bottom:1rem}.author .name{line-height:1rem;padding-top:.5rem}.bd,.media{overflow:hidden;zoom:1}.media .img{float:left}.avatar-img{border-radius:100%;height:3rem;margin-right:.5rem;width:3rem}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace;direction:ltr;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;font-size:.85em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:.2em;padding-top:1px;padding-bottom:1px;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#005cc5}.token.keyword{color:#d73a49}.token.atrule,.token.attr-name{color:#6f42c1}.token.deleted,.token.function{color:#6f42c1}.token.selector{color:#00009f}.token.tag{color:#22863a}.token.class-name{color:#6f42c1}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.caption,figcaption{display:block;font-size:.8rem;text-align:center}.codepen-aspect-ratio>iframe{height:100%;position:absolute;width:100%}.twitter-tweet{margin-left:auto;margin-right:auto}.twitter-tweet::after{content:"";display:block;padding-bottom:20px;width:100%}.me{max-width:22rem;margin:0 auto 1rem;text-align:center}.me>div{height:8rem;margin:0 auto;position:relative;width:8rem}.me svg{border-radius:100%;height:100%;left:0;position:absolute;top:0;width:100%}.me img{border-radius:100%;height:100%;position:relative;width:100%}.me h1{font-size:1.7rem;line-height:2rem;margin-bottom:.5rem}.read-next{background-color:#fdf6ea;margin:2rem 0;padding:1em}@media (prefers-color-scheme:dark){body{background:#515070;color:#eee}a{color:#ffbb91}a:hover{color:#fff}p a{border-bottom:1px solid #ffbb91}p a:hover{border-bottom:1px solid #fff}h1,h2,h3,h4,h5{color:#eee}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#ffbb91}.button:hover{background-color:#ffbb91}code,pre{color:#ddd}.main-header{background-color:#ff8e6e}.read-next{background-color:#020915}}.amp-img-wrapper{position:absolute;height:100%;width:100%}</style><meta name=theme-color content=#005689><link rel=manifest href=/manifest.json></head><body><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-39254352-1","auto"),ga("send","pageview");</script><header class=main-header><nav id=menu><a href="/">Blog</a> <a href=#>Projects</a> <a href=#>About</a></nav></header><div id=page><article class=wrapper><div class=post><header><script type=application/ld+json>{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Ways to authenticate Azure Databricks REST API",
  
  "description": "This article will give you insight on which authentification method to choose for your use-case and also give you a fast track to implementing it (backed by links to Microsoft docs for further details).",
  
  "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://kaabachi.io/ways-to-authenticate-azure-databricks-api/"
  },
  "datePublished": "2020-10-25T10:15:00.000Z",
  "dateModified": "2020-09-25T13:44:23.480Z",
  
  "image": {
    "@type": "ImageObject",
    "url": "https://kaabachi.io/assets/images/posts/auth-databricks/feature.png",
    "width" : "1508",
    "height" : "774"
  },
  
  "author": {
      "@type": "Person",
      "name": "Amine Kaabachi",
      "url": "https://kaabachi.io",
      "sameAs": [
        "http://www.linkedin.com/in/aminekaabachi",
      ]
  },
  "publisher": {
      "@type": "Organization",
      "name": "Amine Kaabachi's Blog"
      
  }
}</script><div class="media author"><div class=img><a href=#><img src="https://avatars0.githubusercontent.com/u/1732576?s=460&u=c7f050fcc3501a22aac1e1b6ac998cdf3ce6f9b1&v=4" class=avatar-img alt height=53 width=53 sizes=53px></a></div><div class=bd><address class=name itemprop=author itemscope itemtype=https://schema.org/Person><a href="/about-me/" itemprop=name>Amine Kaabachi</a></address><meta class=post-data itemprop=datePublished content=2020-10-25T10:15:00.000Z>October 25, 2020<span style="margin:0 .5rem;display:inline-block">|</span> Reading Time: ~<time>6 mins</time></div></div><h1>Ways to authenticate Azure Databricks REST API</h1></header><p>If you ever need to access the <a href="https://docs.microsoft.com/en-us/azure/databricks/dev-tools/api/latest/" target=_blank rel=noopener>Azure Databricks API</a>, you will wonder about the best way to authenticate. Depending on the use-case, there are two ways to access the API: through personal access tokens or Azure AD tokens. Besides, there are also two methods for generating Azure AD tokens, either by impersonating a user or via a service principal. So which way to choose?</p><div style=position:relative;padding-bottom:52.25%><img loading=lazy style="max-width:100%; border: 0;position:absolute;top:0;left:0" sizes="(max-width: 768px) 100vw, 684px" src=/assets/images/posts/auth-databricks/feature.png alt></div><p>This article will give you insight on which method to choose for your use-case and also give you a fast track to implementing SP based auth (backed by links to Microsoft docs for further details).</p><a id=more></a><p>In fact, those methods provide users with many possibilities and enable several use-cases. However, it’s also confusing to have multiple ways to authenticate to the API without giving clear guidelines. I will try to provide some basic rules to help you figure out the best solution for your case.</p><h2 id=What-to-choose><a href=#What-to-choose class=headerlink title="What to choose"></a>What to choose</h2><p>The first criteria to consider is automation:</p><ul><li>If you need to fully automated API calls without having to ask anything from the user. The best solution is to use <strong><em>AD Tokens with a service principal</em></strong>. General use-case is app to app communication.</li><li><strong><em>Impersonating users through AD Tokens</em></strong> is a semi-automatic solution where users still need a way to authenticate through Azure AD but the tokens are automatically generated. The best use-case, Is an app that logins in through Azure AD and then uses the Databricks service on the user’s behalf.</li><li>The manual solution is to generate personal access tokens from the Databricks workspace. It is useful for dev tools and apps. You can also generate multiple tokens per user and revoke each individually.</li></ul><p>The other criteria I can think of is Identity:</p><ul><li><strong><em>Personal access tokens</em></strong> and <strong><em>Impersonating AD Tokens</em></strong> keep track of the user identity. Which is useful in the case of dev teams and interactive analytics workloads. This can also be helpful for audit trial as it enforces <abbr title="Least Privilege Principle">LPP</abbr>.</li><li><strong><em>SPs</em></strong> are generally anonymous. If you still need to keep Identity and use an SP, you will need to come up with more structure like giving each team an SP or something of a sort (But this is more like a hack).</li></ul><h2 id=Accessing-the-API-using-service-principals><a href=#Accessing-the-API-using-service-principals class=headerlink title="Accessing the API using service principals"></a>Accessing the API using service principals</h2><h3 id=Create-a-service-principal><a href=#Create-a-service-principal class=headerlink title="Create a service principal"></a>Create a service principal</h3><p>The first thing is to create a service principal by navigating to <code>Azure Active Directory &gt; App Registrations &gt; New Registrations</code> and to generate a secret on <code>Certificates &amp; secrets</code> on the portal. Refer to <a href="https://docs.microsoft.com/en-us/azure-stack/operator/azure-stack-create-service-principals?view=azs-2005#create-a-service-principal-that-uses-a-client-secret-credential" target=_blank rel=noopener>this link</a> in you need more detailed steps.</p><p>You can also generate it using az cli.</p><pre class=language-powershell><code class=language-powershell><span class="token variable">$sp</span> = New<span class="token operator">-</span>AzADServicePrincipal <span class="token operator">-</span>DisplayName DatabricksSP
</code></pre><p>The returned object contains the Secret member, which is a SecureString containing the generated password. Its value won’t be displayed in the console output. Howver, the following code will allow you to export the secret:</p><pre class=language-powershell><code class=language-powershell><span class="token variable">$BSTR</span> = <span class="token namespace">[System.Runtime.InteropServices.Marshal]</span>::SecureStringToBSTR<span class="token punctuation">(</span><span class="token variable">$sp</span><span class="token punctuation">.</span>Secret<span class="token punctuation">)</span>
<span class="token variable">$UnsecureSecret</span> = <span class="token namespace">[System.Runtime.InteropServices.Marshal]</span>::PtrToStringAuto<span class="token punctuation">(</span><span class="token variable">$BSTR</span><span class="token punctuation">)</span>
</code></pre><p>Now you have a <code>client-id</code> and <code>client-secret</code> to use.</p><h3 id=Generate-a-management-token><a href=#Generate-a-management-token class=headerlink title="Generate a management token"></a>Generate a management token</h3><p>For this you will need your SP credentials and also the Tenant ID.</p><p>You can generate the token using curl for example:</p><pre class=language-curl><code class=language-curl>curl -X GET -H 'Content-Type: application/x-www-form-urlencoded' \
-d 'grant_type=client_credentials&client_id=%client-id%&resource=https://management.core.windows.net/&client_secret=%client-secret%' \
https://login.microsoftonline.com/<tenantid>/oauth2/token
</tenantid></code></pre><p>The same thing can be achieved with this helper python function:</p><pre class=language-python><code class=language-python><span class="token keyword">def</span> <span class="token function">get_management_token</span><span class="token punctuation">(</span>tenant_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://login.microsoftonline.com/%s/oauth2/token'</span> <span class="token operator">%</span> tenant_id
    <span class="token keyword">return</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
        base_url<span class="token punctuation">,</span>
        headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">"grant_type"</span><span class="token punctuation">:</span> <span class="token string">"client_credentials"</span><span class="token punctuation">,</span>
            <span class="token string">"client_id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>client_id<span class="token punctuation">,</span>
            <span class="token string">"client_secret"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>client_secret<span class="token punctuation">,</span>
            <span class="token string">"resource"</span><span class="token punctuation">:</span> <span class="token string">"https://management.core.windows.net/"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre><p>The <code>access_token</code> in the response is the management endpoint access token.</p><h3 id=Generate-an-access-token><a href=#Generate-an-access-token class=headerlink title="Generate an access token"></a>Generate an access token</h3><p>We need to generate an access token with the AzureDatabricks login application as the resource. For this you will also need the SP credentials and Tenant ID.</p><p>You can generate the token using curl for example:</p><pre class=language-curl><code class=language-curl>curl -X GET -H 'Content-Type: application/x-www-form-urlencoded' \
-d 'grant_type=client_credentials&client_id=%client-id%&resource=2ff814a6-3304-4ab8-85cb-cd0e6f879c1d&client_secret=%client-secret%' \
https://login.microsoftonline.com/<tenant-id>/oauth2/token
</tenant-id></code></pre><p>The same thing can be achieved with this helper python function:</p><pre class=language-python><code class=language-python><span class="token keyword">def</span> <span class="token function">get_access_token</span><span class="token punctuation">(</span>tenant_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://login.microsoftonline.com/%s/oauth2/token'</span> <span class="token operator">%</span> tenant_id
    <span class="token keyword">return</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
        base_url<span class="token punctuation">,</span>
        headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">"grant_type"</span><span class="token punctuation">:</span> <span class="token string">"client_credentials"</span><span class="token punctuation">,</span>
            <span class="token string">"client_id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>client_id<span class="token punctuation">,</span>
            <span class="token string">"client_secret"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>client_secret<span class="token punctuation">,</span>
            <span class="token string">"resource"</span><span class="token punctuation">:</span> <span class="token string">"2ff814a6-3304-4ab8-85cb-cd0e6f879c1d"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
</code></pre><p>The <code>access_token</code> in the response is the Azure AD access token.</p><p>To note that Azure Databricks resource ID is static value always equal to <code>2ff814a6-3304-4ab8-85cb-cd0e6f879c1d</code>.</p><h3 id=Calling-the-API><a href=#Calling-the-API class=headerlink title="Calling the API"></a>Calling the API</h3><p>To showcase how to use the databricks API. I implemented python wrapper for those operations:</p><pre class=language-python><code class=language-python><span class="token keyword">class</span> <span class="token class-name">DatabricksAPIInterface</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run_now_job</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> job_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> run_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run_submit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run_cancel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> run_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><p>To be able to call the API endpoints. You will need to provide a <code>X-Databricks-Azure-Workspace-Resource-Id</code> as header which will specify the workspace resource ID. It follows this template : <code>/subscriptions/%subscription-id%/resourceGroups/&lt;resource-group-name&gt;/providers/Microsoft.Databricks/workspaces/%workspace-name%</code>. You can also get it from the resources explorer.</p><pre class=language-python><code class=language-python>
<span class="token keyword">import</span> requests

<span class="token keyword">class</span> <span class="token class-name">DatabricksAPI</span><span class="token punctuation">(</span>DatabricksAPIInterface<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>host <span class="token operator">=</span> <span class="token string">"databricks_url"</span>
        self<span class="token punctuation">.</span>resource_id <span class="token operator">=</span> <span class="token string">"resource_id"</span>
        self<span class="token punctuation">.</span>base_url <span class="token operator">=</span> <span class="token string">'https://%s/api/2.0'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>host<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>access_token <span class="token operator">=</span> get_access_token<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>mgmt_token <span class="token operator">=</span> get_management_token<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">run_now_job</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> job_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
            <span class="token string">"%s/jobs/run-now"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span>
            headers<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer %s"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-SP-Management-Token"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>mgmt_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-Workspace-Resource-Id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>resource_id<span class="token punctuation">,</span>
                <span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"job_id"</span><span class="token punctuation">:</span> job_id<span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> run_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        job_result <span class="token operator">=</span> <span class="token string">'%s/jobs/runs/get?run_id=%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span> run_id<span class="token punctuation">)</span>
        <span class="token keyword">return</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
            job_result<span class="token punctuation">,</span>
            headers<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer %s"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-SP-Management-Token"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>mgmt_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-Workspace-Resource-Id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>resource_id<span class="token punctuation">,</span>
                <span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run_submit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
            <span class="token string">"%s/jobs/runs/submit"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span>
            headers<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer %s"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-SP-Management-Token"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>mgmt_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-Workspace-Resource-Id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>resource_id<span class="token punctuation">,</span>
                <span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            json<span class="token operator">=</span>json
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">run_cancel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> run_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
            <span class="token string">"%s/jobs/runs/cancel"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>base_url<span class="token punctuation">,</span>
            headers<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer %s"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-SP-Management-Token"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>mgmt_token<span class="token punctuation">,</span>
                <span class="token string">"X-Databricks-Azure-Workspace-Resource-Id"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>resource_id<span class="token punctuation">,</span>
                <span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json"</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            json<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'run_id'</span><span class="token punctuation">:</span> run_id<span class="token punctuation">}</span>
        <span class="token punctuation">)</span>

</code></pre><h2 id=Wrapping-up><a href=#Wrapping-up class=headerlink title="Wrapping up"></a>Wrapping up</h2><p>In this article, I showcased some rules and patterns to help you choose which authentification method to access Azure Databricks API. I also showed a fast track on implementing an SP based Auth on Admin mode, refer to <a href=https://docs.microsoft.com/en-us/azure/databricks/dev-tools/api/latest/aad/service-prin-aad-token#non-admin-user-login target=_blank rel=noopener>these docs</a> for non-admin use cases.</p><p>I hope this article was useful. Feel free to comment on Medium or to reach me if you need more help or to discuss specific use-cases.</p></div><hr>Tags:<ul class=tag-list><li class=tag-list-item><a class=tag-list-link href="/tags/azure/">azure</a></li><li class=tag-list-item><a class=tag-list-link href="/tags/databricks/">databricks</a></li></ul></article></div><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){})["catch"](function(n){})});</script><footer><section class=links>Reach me via <a href=mailto:ping@kaabachi.io rel=me>ping@kaabachi.io</a> · <a href=https://github.com/aminekaabachi rel=me>GitHub</a> · <a href=https://www.linkedin.com/in/aminekaabachi>LinkedIn</a> · <a href=https://medium.com/@amine.kaabachi>Medium</a> · <a href=https://dribbble.com/aminekaabachi>Dribbble</a></section><div class=timing-stats></div></footer><script>window.addEventListener('load', () => {
     setTimeout(() => {
      var t = window.performance && performance.timing;
      function round2(num) { return Math.round(num * 100) / 100; }
      if (t) {
        var timingStats = document.querySelector('.timing-stats');
        var loadTime = (t.loadEventEnd - t.navigationStart) / 1000;
        var timingStatsHTML = 'This page loaded in ' + round2(loadTime) + ' seconds. ';
        var performanceEntries = performance.getEntriesByType('paint');
        performanceEntries.forEach(function(performanceEntry, i, entries) {
          var name = performanceEntry.name;
          if (name === 'first-paint') {
            name = '<abbr title=' + name + '>FP</abbr>';
          } else if (name === 'first-contentful-paint') {
            name = '<abbr title=' + name + '>FCP</abbr>';
          }
          timingStatsHTML += name + ' was ' + round2(performanceEntry.startTime / 1000) + ' seconds. ';
        });
        timingStats.innerHTML = timingStatsHTML;
      }
    }, 0);
   });</script><script src=/quicklink.js async></script><script src=https://unpkg.com/turbolinks@5.2.0/dist/turbolinks.js async data-turbolinks-suppress-warning></script></body></html>